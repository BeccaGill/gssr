<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>An Overview of gssr • gssr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="An Overview of gssr">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gssr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/overview.html">An Overview of gssr</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/kjhealy/gssr">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>An Overview of gssr</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/kjhealy/gssr/blob/master/vignettes/overview.Rmd"><code>vignettes/overview.Rmd</code></a></small>
      <div class="hidden name"><code>overview.Rmd</code></div>

    </div>

    
    
<div id="setup-packages-and-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#setup-packages-and-functions" class="anchor"></a>Setup, Packages, and Functions</h2>
<div id="packages" class="section level3">
<h3 class="hasAnchor">
<a href="#packages" class="anchor"></a>Packages</h3>
<p>This article, along with the <code>gssr</code> package itself, makes use of some Tidyverse packages together with R tools designed for complex survey data.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co">#&gt; Attaching package: 'dplyr'</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co">#&gt; The following objects are masked from 'package:stats':</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co">#&gt;     filter, lag</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co">#&gt; The following objects are masked from 'package:base':</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="co">#&gt;     intersect, setdiff, setequal, union</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(survey)</a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="co">#&gt; Loading required package: grid</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="co">#&gt; Loading required package: Matrix</span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14"><span class="co">#&gt; Loading required package: survival</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="co">#&gt; Attaching package: 'survey'</span></a>
<a class="sourceLine" id="cb1-17" data-line-number="17"><span class="co">#&gt; The following object is masked from 'package:graphics':</span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-19" data-line-number="19"><span class="co">#&gt;     dotchart</span></a>
<a class="sourceLine" id="cb1-20" data-line-number="20"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(srvyr)</a>
<a class="sourceLine" id="cb1-21" data-line-number="21"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-22" data-line-number="22"><span class="co">#&gt; Attaching package: 'srvyr'</span></a>
<a class="sourceLine" id="cb1-23" data-line-number="23"><span class="co">#&gt; The following object is masked from 'package:stats':</span></a>
<a class="sourceLine" id="cb1-24" data-line-number="24"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-25" data-line-number="25"><span class="co">#&gt;     filter</span></a></code></pre></div>
</div>
<div id="functions" class="section level3">
<h3 class="hasAnchor">
<a href="#functions" class="anchor"></a>Functions</h3>
<p>Three quick-and-dirty functions, one to help clean some labels, one to define some custom colors for our plot, and one to title-case variable labels.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">convert_agegrp &lt;-<span class="st"> </span><span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">    x &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">"</span><span class="ch">\\</span><span class="st">("</span>, <span class="st">""</span>, x)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">    x &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">"</span><span class="ch">\\</span><span class="st">["</span>, <span class="st">""</span>, x)</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">    x &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">"</span><span class="ch">\\</span><span class="st">]"</span>, <span class="st">""</span>, x)</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">    x &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">","</span>, <span class="st">"-"</span>, x)</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">    x &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">"-89"</span>, <span class="st">"+"</span>, x)</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">    regex &lt;-<span class="st"> "^(.*$)"</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8">    x &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(regex, <span class="st">"Age </span><span class="ch">\\</span><span class="st">1"</span>, x)</a>
<a class="sourceLine" id="cb2-9" data-line-number="9">    x</a>
<a class="sourceLine" id="cb2-10" data-line-number="10">}</a>
<a class="sourceLine" id="cb2-11" data-line-number="11"></a>
<a class="sourceLine" id="cb2-12" data-line-number="12">my_colors &lt;-<span class="st"> </span><span class="cf">function</span> (<span class="dt">palette =</span> <span class="st">"cb"</span>) </a>
<a class="sourceLine" id="cb2-13" data-line-number="13">{</a>
<a class="sourceLine" id="cb2-14" data-line-number="14">    cb.palette &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"#000000"</span>, <span class="st">"#E69F00"</span>, <span class="st">"#56B4E9"</span>, <span class="st">"#009E73"</span>, </a>
<a class="sourceLine" id="cb2-15" data-line-number="15">        <span class="st">"#F0E442"</span>, <span class="st">"#0072B2"</span>, <span class="st">"#D55E00"</span>, <span class="st">"#CC79A7"</span>)</a>
<a class="sourceLine" id="cb2-16" data-line-number="16">    rcb.palette &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(cb.palette)</a>
<a class="sourceLine" id="cb2-17" data-line-number="17">    bly.palette &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"#E69F00"</span>, <span class="st">"#0072B2"</span>, <span class="st">"#000000"</span>, <span class="st">"#56B4E9"</span>, </a>
<a class="sourceLine" id="cb2-18" data-line-number="18">        <span class="st">"#009E73"</span>, <span class="st">"#F0E442"</span>, <span class="st">"#D55E00"</span>, <span class="st">"#CC79A7"</span>)</a>
<a class="sourceLine" id="cb2-19" data-line-number="19">    <span class="cf">if</span> (palette <span class="op">==</span><span class="st"> "cb"</span>) </a>
<a class="sourceLine" id="cb2-20" data-line-number="20">        <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(cb.palette)</a>
<a class="sourceLine" id="cb2-21" data-line-number="21">    <span class="cf">else</span> <span class="cf">if</span> (palette <span class="op">==</span><span class="st"> "rcb"</span>) </a>
<a class="sourceLine" id="cb2-22" data-line-number="22">        <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(rcb.palette)</a>
<a class="sourceLine" id="cb2-23" data-line-number="23">    <span class="cf">else</span> <span class="cf">if</span> (palette <span class="op">==</span><span class="st"> "bly"</span>) </a>
<a class="sourceLine" id="cb2-24" data-line-number="24">        <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(bly.palette)</a>
<a class="sourceLine" id="cb2-25" data-line-number="25">    <span class="cf">else</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span>(<span class="st">"Choose cb, rcb, or bly only."</span>)</a>
<a class="sourceLine" id="cb2-26" data-line-number="26">}</a>
<a class="sourceLine" id="cb2-27" data-line-number="27"></a>
<a class="sourceLine" id="cb2-28" data-line-number="28"><span class="co"># from help(chartr)</span></a>
<a class="sourceLine" id="cb2-29" data-line-number="29">capwords &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">strict =</span> <span class="ot">FALSE</span>) {</a>
<a class="sourceLine" id="cb2-30" data-line-number="30">    cap &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/chartr.html">toupper</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/substr.html">substring</a></span>(x, <span class="dv">1</span>, <span class="dv">1</span>)),</a>
<a class="sourceLine" id="cb2-31" data-line-number="31">                  {x &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/substr.html">substring</a></span>(x, <span class="dv">2</span>); <span class="cf">if</span>(strict) <span class="kw"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span>(x) <span class="cf">else</span> x},</a>
<a class="sourceLine" id="cb2-32" data-line-number="32">                             <span class="dt">sep =</span> <span class="st">""</span>, <span class="dt">collapse =</span> <span class="st">" "</span> )</a>
<a class="sourceLine" id="cb2-33" data-line-number="33">    <span class="kw"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span>(x, <span class="dt">split =</span> <span class="st">" "</span>), cap, <span class="dt">USE.NAMES =</span> <span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(x)))</a>
<a class="sourceLine" id="cb2-34" data-line-number="34">}</a></code></pre></div>
</div>
</div>
<div id="loading-the-gssr-package-and-data" class="section level2">
<h2 class="hasAnchor">
<a href="#loading-the-gssr-package-and-data" class="anchor"></a>Loading the gssr package and data</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(gssr)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co">#&gt; Package loaded. To attach the GSS data, type data(gss_all) at the console.</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co">#&gt; For the codebook, type data(gss_doc). The gss_all and gss_doc objects will then be available to use.</span></a></code></pre></div>
<p>As the startup message notes, the data objects are not automatically loaded. That is, we do not use R’s “lazy loading” functionality. This is because the main GSS dataset is rather large. Instead we load it manually with <code><a href="https://rdrr.io/r/utils/data.html">data()</a></code>. For the purposes of this vignette, because the full GSS object is big, we will use just a few columns of it stored in an object called <code>gss_sub</code>. We will also load the tibble that contains the codebook.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(gss_sub)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(gss_doc)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"></a>
<a class="sourceLine" id="cb4-4" data-line-number="4">gss_doc</a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#&gt; # A tibble: 6,144 x 5</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt;    id     description      properties   marginals   text                   </span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt;    &lt;chr&gt;  &lt;chr&gt;            &lt;list&gt;       &lt;list&gt;      &lt;chr&gt;                  </span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#&gt;  1 caseid YEAR + Responde… &lt;tibble [2 … &lt;tibble [1… None                   </span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt;  2 year   GSS year for th… &lt;tibble [2 … &lt;tibble [3… None                   </span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co">#&gt;  3 id     Respondent ID n… &lt;tibble [2 … &lt;tibble [1… None                   </span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">#&gt;  4 age    Age of responde… &lt;tibble [3 … &lt;tibble [1… 13. Respondent's age   </span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co">#&gt;  5 sex    Respondents sex  &lt;tibble [3 … &lt;tibble [3… 23. Code respondent's …</span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="co">#&gt;  6 race   Race of respond… &lt;tibble [3 … &lt;tibble [4… 24. What race do you c…</span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14"><span class="co">#&gt;  7 racec… What Is R's rac… &lt;tibble [3 … &lt;tibble [2… 1602. What is your rac…</span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="co">#&gt;  8 racec… What Is R's rac… &lt;tibble [3 … &lt;tibble [2… 1602. What is your rac…</span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="co">#&gt;  9 racec… What Is R's rac… &lt;tibble [3 … &lt;tibble [2… 1602. What is your rac…</span></a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="co">#&gt; 10 hispa… Hispanic specif… &lt;tibble [3 … &lt;tibble [3… 1601. IF R IS FEMALE, …</span></a>
<a class="sourceLine" id="cb4-18" data-line-number="18"><span class="co">#&gt; # … with 6,134 more rows</span></a></code></pre></div>
<p>The GSS data comes in a <em>labelled</em> format, mirroring the way it is encoded for Stata and SPSS platforms. The numeric codes are the content of the column cells. The labeling information is stored as an attribute of the column.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">gss_sub</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co">#&gt; # A tibble: 64,814 x 14</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="co">#&gt;     year    id ballot   age  race   sex fefam  vpsu vstrat oversamp formwt</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co">#&gt;  1  1972     1     NA    23     1     2    NA    NA     NA        1      1</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co">#&gt;  2  1972     2     NA    70     1     1    NA    NA     NA        1      1</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co">#&gt;  3  1972     3     NA    48     1     2    NA    NA     NA        1      1</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co">#&gt;  4  1972     4     NA    27     1     2    NA    NA     NA        1      1</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co">#&gt;  5  1972     5     NA    61     1     2    NA    NA     NA        1      1</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="co">#&gt;  6  1972     6     NA    26     1     1    NA    NA     NA        1      1</span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="co">#&gt;  7  1972     7     NA    28     1     1    NA    NA     NA        1      1</span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12"><span class="co">#&gt;  8  1972     8     NA    27     1     1    NA    NA     NA        1      1</span></a>
<a class="sourceLine" id="cb5-13" data-line-number="13"><span class="co">#&gt;  9  1972     9     NA    21     2     2    NA    NA     NA        1      1</span></a>
<a class="sourceLine" id="cb5-14" data-line-number="14"><span class="co">#&gt; 10  1972    10     NA    30     2     2    NA    NA     NA        1      1</span></a>
<a class="sourceLine" id="cb5-15" data-line-number="15"><span class="co">#&gt; # … with 64,804 more rows, and 3 more variables: wtssall &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb5-16" data-line-number="16"><span class="co">#&gt; #   sampcode &lt;dbl&gt;, sample &lt;dbl&gt;</span></a></code></pre></div>
<p>We will use the label information later when recoding the variables into, say, character or factor variables. The labels and values are reflected in the codebook tibble. To see them, pull out the <code>marginals</code> list-column:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">gss_doc <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(id <span class="op">==</span><span class="st"> "race"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(marginals) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="st">  </span>tidyr<span class="op">::</span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span>(<span class="dt">cols =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(marginals))</a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="co">#&gt; # A tibble: 4 x 5</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="co">#&gt;   percent n      value label id   </span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="co">#&gt;     &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="co">#&gt; 1    80.3 52,033 1     WHITE RACE </span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="co">#&gt; 2    14.2 9,187  2     BLACK RACE </span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="co">#&gt; 3     5.5 3,594  3     OTHER RACE </span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="co">#&gt; 4   100   64,814 &lt;NA&gt;  Total RACE</span></a></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">gss_doc <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(id <span class="op">==</span><span class="st"> "sex"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(marginals) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="st">  </span>tidyr<span class="op">::</span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span>(<span class="dt">cols =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(marginals))</a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#&gt; # A tibble: 3 x 5</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co">#&gt;   percent n      value label  id   </span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#&gt;     &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">#&gt; 1    44.1 28,614 1     MALE   SEX  </span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">#&gt; 2    55.9 36,200 2     FEMALE SEX  </span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="co">#&gt; 3   100   64,814 &lt;NA&gt;  Total  SEX</span></a></code></pre></div>
</div>
<div id="descriptive-analysis-of-the-data-an-example" class="section level2">
<h2 class="hasAnchor">
<a href="#descriptive-analysis-of-the-data-an-example" class="anchor"></a>Descriptive analysis of the data: an example</h2>
<p>The GSS is a complex survey. When working with it, we need to take its structure into account in order to properly calculate statistics such as the population mean for a variable in some year, its standard error, and so on. For these tasks we use the <code>survey</code> and <code>srvyr</code> packages. For details on <code>survey</code>, see Lumley (2010). We will also do some recoding prior to analyzing the data, so we load several additional <code>tidyverse</code> packages to assist us.</p>
<p>We will examine a topic that was the subject of recent media attention, in the <em>New York Times</em> and elsewhere, regarding the beliefs of young men about gender roles. Some surveys seemed to point to some recent increasing conservatism on this front amongst young men. As it happens, the GSS has a longstanding question named <code>fefam</code>, where respondents are asked to give their opinion on the following statement:</p>
<blockquote>
<p>It is much better for everyone involved if the man is the achiever outside the home and the woman takes care of the home and family.</p>
</blockquote>
<p>Respondents may answer that they Strongly Agree, Agree, Disagree, or Strongly Disagree with the statement (as well as refusing to answer, or saying they don’t know).</p>
<div id="subsetting-the-dataset" class="section level3">
<h3 class="hasAnchor">
<a href="#subsetting-the-dataset" class="anchor"></a>Subsetting the Dataset</h3>
<p>The GSS data retains labeling information (as it was originally imported via the <code>haven</code> package). When working with the data in an analysis, we will probably want to convert the labeled variables to data types such as factors. This should be done with care (and not on the whole dataset all at once). Typically, we will want to focus on some relatively small subset of variables and examine those. For example, let’s say we want to explore the <code>fefam</code> question. We will subset the data and then prepare that for analysis. Here we are going to subset <code>gss_sub</code> into an object called <code>gss_fam</code> containing just the variables we want to examine, along with core measures that identify respondents (such as <code>id</code> and <code>year</code>) and variables necessary for the survey weighting later (such as <code>wtssall</code>).</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">cont_vars &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"year"</span>, <span class="st">"id"</span>, <span class="st">"ballot"</span>, <span class="st">"age"</span>)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"></a>
<a class="sourceLine" id="cb8-3" data-line-number="3">cat_vars &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"race"</span>, <span class="st">"sex"</span>, <span class="st">"fefam"</span>)</a>
<a class="sourceLine" id="cb8-4" data-line-number="4"></a>
<a class="sourceLine" id="cb8-5" data-line-number="5">wt_vars &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"vpsu"</span>,</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">             <span class="st">"vstrat"</span>,</a>
<a class="sourceLine" id="cb8-7" data-line-number="7">             <span class="st">"oversamp"</span>,</a>
<a class="sourceLine" id="cb8-8" data-line-number="8">             <span class="st">"formwt"</span>,              <span class="co"># weight to deal with experimental randomization</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9">             <span class="st">"wtssall"</span>,             <span class="co"># weight variable</span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10">             <span class="st">"sampcode"</span>,            <span class="co"># sampling error code</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11">             <span class="st">"sample"</span>)              <span class="co"># sampling frame and method</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"></a>
<a class="sourceLine" id="cb8-13" data-line-number="13">vars &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(cont_vars, cat_vars, wt_vars)</a>
<a class="sourceLine" id="cb8-14" data-line-number="14"></a>
<a class="sourceLine" id="cb8-15" data-line-number="15">gss_fam &lt;-<span class="st"> </span>gss_sub <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-16" data-line-number="16"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(cont_vars, cat_vars, wt_vars))</a>
<a class="sourceLine" id="cb8-17" data-line-number="17"></a>
<a class="sourceLine" id="cb8-18" data-line-number="18">gss_fam</a>
<a class="sourceLine" id="cb8-19" data-line-number="19"><span class="co">#&gt; # A tibble: 64,814 x 14</span></a>
<a class="sourceLine" id="cb8-20" data-line-number="20"><span class="co">#&gt;     year    id ballot   age  race   sex fefam  vpsu vstrat oversamp formwt</span></a>
<a class="sourceLine" id="cb8-21" data-line-number="21"><span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb8-22" data-line-number="22"><span class="co">#&gt;  1  1972     1     NA    23     1     2    NA    NA     NA        1      1</span></a>
<a class="sourceLine" id="cb8-23" data-line-number="23"><span class="co">#&gt;  2  1972     2     NA    70     1     1    NA    NA     NA        1      1</span></a>
<a class="sourceLine" id="cb8-24" data-line-number="24"><span class="co">#&gt;  3  1972     3     NA    48     1     2    NA    NA     NA        1      1</span></a>
<a class="sourceLine" id="cb8-25" data-line-number="25"><span class="co">#&gt;  4  1972     4     NA    27     1     2    NA    NA     NA        1      1</span></a>
<a class="sourceLine" id="cb8-26" data-line-number="26"><span class="co">#&gt;  5  1972     5     NA    61     1     2    NA    NA     NA        1      1</span></a>
<a class="sourceLine" id="cb8-27" data-line-number="27"><span class="co">#&gt;  6  1972     6     NA    26     1     1    NA    NA     NA        1      1</span></a>
<a class="sourceLine" id="cb8-28" data-line-number="28"><span class="co">#&gt;  7  1972     7     NA    28     1     1    NA    NA     NA        1      1</span></a>
<a class="sourceLine" id="cb8-29" data-line-number="29"><span class="co">#&gt;  8  1972     8     NA    27     1     1    NA    NA     NA        1      1</span></a>
<a class="sourceLine" id="cb8-30" data-line-number="30"><span class="co">#&gt;  9  1972     9     NA    21     2     2    NA    NA     NA        1      1</span></a>
<a class="sourceLine" id="cb8-31" data-line-number="31"><span class="co">#&gt; 10  1972    10     NA    30     2     2    NA    NA     NA        1      1</span></a>
<a class="sourceLine" id="cb8-32" data-line-number="32"><span class="co">#&gt; # … with 64,804 more rows, and 3 more variables: wtssall &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb8-33" data-line-number="33"><span class="co">#&gt; #   sampcode &lt;dbl&gt;, sample &lt;dbl&gt;</span></a></code></pre></div>
</div>
<div id="recode-the-subsetted-data" class="section level3">
<h3 class="hasAnchor">
<a href="#recode-the-subsetted-data" class="anchor"></a>Recode the Subsetted Data</h3>
<p>Next, some recoding, along with creating some new variables. We will clean up <code>gss_fam</code> a bit, discarding some of the label and missing value information we don’t need. We also create some new variables: age quintiles, a variable flagging whether a respondent is 25 or younger, recoded <code>fefam</code> to binary “Agree” or “Disagree” (with non-responses dropped).</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">qrts &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(gss_fam<span class="op">$</span>age), </a>
<a class="sourceLine" id="cb9-2" data-line-number="2">                 <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">qrts</a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="co">#&gt;   0%  25%  50%  75% 100% </span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="co">#&gt;   18   31   44   59   89</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"></a>
<a class="sourceLine" id="cb9-7" data-line-number="7">quintiles &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(gss_fam<span class="op">$</span>age), </a>
<a class="sourceLine" id="cb9-8" data-line-number="8">                      <span class="dt">probs =</span> <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.2</span>), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb9-9" data-line-number="9"></a>
<a class="sourceLine" id="cb9-10" data-line-number="10">quintiles</a>
<a class="sourceLine" id="cb9-11" data-line-number="11"><span class="co">#&gt;   0%  20%  40%  60%  80% 100% </span></a>
<a class="sourceLine" id="cb9-12" data-line-number="12"><span class="co">#&gt;   18   29   38   49   63   89</span></a>
<a class="sourceLine" id="cb9-13" data-line-number="13"></a>
<a class="sourceLine" id="cb9-14" data-line-number="14">## Recoding</a>
<a class="sourceLine" id="cb9-15" data-line-number="15">gss_fam &lt;-<span class="st"> </span>gss_fam <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-16" data-line-number="16"><span class="st">  </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/modify.html">modify_at</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(), haven<span class="op">::</span>zap_missing) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-17" data-line-number="17"><span class="st">  </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/modify.html">modify_at</a></span>(wt_vars, as.numeric) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-18" data-line-number="18"><span class="st">  </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/modify.html">modify_at</a></span>(cat_vars, forcats<span class="op">::</span>as_factor) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-19" data-line-number="19"><span class="st">  </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/modify.html">modify_at</a></span>(cat_vars, forcats<span class="op">::</span>fct_relabel, capwords, <span class="dt">strict =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-20" data-line-number="20"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">ageq =</span> <span class="kw"><a href="https://rdrr.io/r/base/cut.html">cut</a></span>(<span class="dt">x =</span> age, <span class="dt">breaks =</span> <span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(qrts), <span class="dt">include.lowest =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb9-21" data-line-number="21">           <span class="dt">ageq =</span>  forcats<span class="op">::</span><span class="kw"><a href="https://forcats.tidyverse.org/reference/fct_relabel.html">fct_relabel</a></span>(ageq, convert_agegrp),</a>
<a class="sourceLine" id="cb9-22" data-line-number="22">           <span class="dt">agequint =</span> <span class="kw"><a href="https://rdrr.io/r/base/cut.html">cut</a></span>(<span class="dt">x =</span> age, <span class="dt">breaks =</span> <span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(quintiles), <span class="dt">include.lowest =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb9-23" data-line-number="23">           <span class="dt">agequint =</span> forcats<span class="op">::</span><span class="kw"><a href="https://forcats.tidyverse.org/reference/fct_relabel.html">fct_relabel</a></span>(agequint, convert_agegrp),</a>
<a class="sourceLine" id="cb9-24" data-line-number="24">           <span class="dt">year_f =</span> <span class="kw"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(year)),</a>
<a class="sourceLine" id="cb9-25" data-line-number="25">           <span class="dt">young =</span> <span class="kw"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(age <span class="op">&lt;</span><span class="st"> </span><span class="dv">26</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>),</a>
<a class="sourceLine" id="cb9-26" data-line-number="26">           <span class="dt">fefam =</span> forcats<span class="op">::</span><span class="kw"><a href="https://forcats.tidyverse.org/reference/fct_recode.html">fct_recode</a></span>(fefam, <span class="dt">NULL =</span> <span class="st">"IAP"</span>, <span class="dt">NULL =</span> <span class="st">"DK"</span>, <span class="dt">NULL =</span> <span class="st">"NA"</span>),</a>
<a class="sourceLine" id="cb9-27" data-line-number="27">           <span class="dt">fefam_d =</span> forcats<span class="op">::</span><span class="kw"><a href="https://forcats.tidyverse.org/reference/fct_recode.html">fct_recode</a></span>(fefam,</a>
<a class="sourceLine" id="cb9-28" data-line-number="28">                                <span class="dt">Agree =</span> <span class="st">"Strongly Agree"</span>,</a>
<a class="sourceLine" id="cb9-29" data-line-number="29">                                <span class="dt">Disagree =</span> <span class="st">"Strongly Disagree"</span>),</a>
<a class="sourceLine" id="cb9-30" data-line-number="30">           <span class="dt">fefam_n =</span> <span class="kw"><a href="https://dplyr.tidyverse.org/reference/recode.html">recode</a></span>(fefam_d, <span class="st">"Agree"</span> =<span class="st"> </span><span class="dv">0</span>, <span class="st">"Disagree"</span> =<span class="st"> </span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb9-31" data-line-number="31"></a>
<a class="sourceLine" id="cb9-32" data-line-number="32">gss_fam &lt;-<span class="st"> </span>gss_fam <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-33" data-line-number="33"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">compwt =</span> oversamp <span class="op">*</span><span class="st"> </span>formwt <span class="op">*</span><span class="st"> </span>wtssall, </a>
<a class="sourceLine" id="cb9-34" data-line-number="34">         <span class="dt">samplerc =</span> <span class="kw"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span>(sample <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>) <span class="op">~</span><span class="st"> </span><span class="dv">3</span>, </a>
<a class="sourceLine" id="cb9-35" data-line-number="35">                              sample <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">6</span><span class="op">:</span><span class="dv">7</span>) <span class="op">~</span><span class="st"> </span><span class="dv">6</span>,</a>
<a class="sourceLine" id="cb9-36" data-line-number="36">                              <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>sample))</a>
<a class="sourceLine" id="cb9-37" data-line-number="37"></a>
<a class="sourceLine" id="cb9-38" data-line-number="38">gss_fam</a>
<a class="sourceLine" id="cb9-39" data-line-number="39"><span class="co">#&gt; # A tibble: 64,814 x 22</span></a>
<a class="sourceLine" id="cb9-40" data-line-number="40"><span class="co">#&gt;     year    id ballot   age race  sex   fefam  vpsu vstrat oversamp formwt</span></a>
<a class="sourceLine" id="cb9-41" data-line-number="41"><span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl+&gt; &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb9-42" data-line-number="42"><span class="co">#&gt;  1  1972     1     NA    23 White Fema… &lt;NA&gt;     NA     NA        1      1</span></a>
<a class="sourceLine" id="cb9-43" data-line-number="43"><span class="co">#&gt;  2  1972     2     NA    70 White Male  &lt;NA&gt;     NA     NA        1      1</span></a>
<a class="sourceLine" id="cb9-44" data-line-number="44"><span class="co">#&gt;  3  1972     3     NA    48 White Fema… &lt;NA&gt;     NA     NA        1      1</span></a>
<a class="sourceLine" id="cb9-45" data-line-number="45"><span class="co">#&gt;  4  1972     4     NA    27 White Fema… &lt;NA&gt;     NA     NA        1      1</span></a>
<a class="sourceLine" id="cb9-46" data-line-number="46"><span class="co">#&gt;  5  1972     5     NA    61 White Fema… &lt;NA&gt;     NA     NA        1      1</span></a>
<a class="sourceLine" id="cb9-47" data-line-number="47"><span class="co">#&gt;  6  1972     6     NA    26 White Male  &lt;NA&gt;     NA     NA        1      1</span></a>
<a class="sourceLine" id="cb9-48" data-line-number="48"><span class="co">#&gt;  7  1972     7     NA    28 White Male  &lt;NA&gt;     NA     NA        1      1</span></a>
<a class="sourceLine" id="cb9-49" data-line-number="49"><span class="co">#&gt;  8  1972     8     NA    27 White Male  &lt;NA&gt;     NA     NA        1      1</span></a>
<a class="sourceLine" id="cb9-50" data-line-number="50"><span class="co">#&gt;  9  1972     9     NA    21 Black Fema… &lt;NA&gt;     NA     NA        1      1</span></a>
<a class="sourceLine" id="cb9-51" data-line-number="51"><span class="co">#&gt; 10  1972    10     NA    30 Black Fema… &lt;NA&gt;     NA     NA        1      1</span></a>
<a class="sourceLine" id="cb9-52" data-line-number="52"><span class="co">#&gt; # … with 64,804 more rows, and 11 more variables: wtssall &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb9-53" data-line-number="53"><span class="co">#&gt; #   sampcode &lt;dbl&gt;, sample &lt;dbl&gt;, ageq &lt;fct&gt;, agequint &lt;fct&gt;,</span></a>
<a class="sourceLine" id="cb9-54" data-line-number="54"><span class="co">#&gt; #   year_f &lt;fct&gt;, young &lt;chr&gt;, fefam_d &lt;fct&gt;, fefam_n &lt;dbl&gt;, compwt &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb9-55" data-line-number="55"><span class="co">#&gt; #   samplerc &lt;dbl&gt;</span></a></code></pre></div>
</div>
<div id="integrate-the-survey-weights" class="section level3">
<h3 class="hasAnchor">
<a href="#integrate-the-survey-weights" class="anchor"></a>Integrate the Survey Weights</h3>
<p>Nexr, we set up the data so we can properly calculate population means and errors and so on. We use <code>svyr</code>’s wrappers to <code>survey</code> for this.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/options.html">options</a></span>(<span class="dt">survey.lonely.psu =</span> <span class="st">"adjust"</span>)</a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/options.html">options</a></span>(<span class="dt">na.action=</span><span class="st">"na.pass"</span>)</a>
<a class="sourceLine" id="cb10-4" data-line-number="4"></a>
<a class="sourceLine" id="cb10-5" data-line-number="5">gss_svy &lt;-<span class="st"> </span>gss_fam <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(year <span class="op">&gt;</span><span class="st"> </span><span class="dv">1974</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="st">    </span>tidyr<span class="op">::</span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span>(fefam_d, young) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">stratvar =</span> <span class="kw"><a href="https://rdrr.io/r/base/interaction.html">interaction</a></span>(year, vstrat)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="st">    </span><span class="kw"><a href="https://rdrr.io/pkg/srvyr/man/as_survey_design.html">as_survey_design</a></span>(<span class="dt">id =</span> vpsu,</a>
<a class="sourceLine" id="cb10-10" data-line-number="10">                     <span class="dt">strata =</span> stratvar,</a>
<a class="sourceLine" id="cb10-11" data-line-number="11">                     <span class="dt">weights =</span> wtssall,</a>
<a class="sourceLine" id="cb10-12" data-line-number="12">                     <span class="dt">nest =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>The <code>gss_svy</code> object contains the same data as <code>gss_fam</code>, but incorporates information about the sampling structure in a way that the <code>survey</code> package’s functions can work with:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">gss_svy</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="co">#&gt; Stratified 1 - level Cluster Sampling design (with replacement)</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="co">#&gt; With (3583) clusters.</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="co">#&gt; Called via srvyr</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="co">#&gt; Sampling variables:</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="co">#&gt;  - ids: vpsu</span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="co">#&gt;  - strata: stratvar</span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="co">#&gt;  - weights: wtssall</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="co">#&gt; Data variables: year (dbl), id (dbl), ballot (dbl+lbl), age (dbl+lbl),</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="co">#&gt;   race (fct), sex (fct), fefam (fct), vpsu (dbl), vstrat (dbl), oversamp</span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="co">#&gt;   (dbl), formwt (dbl), wtssall (dbl), sampcode (dbl), sample (dbl), ageq</span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="co">#&gt;   (fct), agequint (fct), year_f (fct), young (chr), fefam_d (fct), fefam_n</span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13"><span class="co">#&gt;   (dbl), compwt (dbl), samplerc (dbl), stratvar (fct)</span></a></code></pre></div>
</div>
</div>
<div id="calculate-the-survey-weighted-statistics" class="section level2">
<h2 class="hasAnchor">
<a href="#calculate-the-survey-weighted-statistics" class="anchor"></a>Calculate the survey-weighted statistics</h2>
<p>We’re now in a position to calculate some properly-weighted summary statistics for the variable we’re interested in, for every year in the data.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">## Get the breakdown for every year</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">out_ff &lt;-<span class="st"> </span>gss_svy <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(year, sex, young, fefam_d) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span>(<span class="dt">prop =</span> <span class="kw"><a href="https://rdrr.io/pkg/srvyr/man/survey_mean.html">survey_mean</a></span>(<span class="dt">na.rm =</span> <span class="ot">TRUE</span>, <span class="dt">vartype =</span> <span class="st">"ci"</span>))</a>
<a class="sourceLine" id="cb12-5" data-line-number="5"></a>
<a class="sourceLine" id="cb12-6" data-line-number="6">out_ff</a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="co">#&gt; # A tibble: 168 x 7</span></a>
<a class="sourceLine" id="cb12-8" data-line-number="8"><span class="co">#&gt;     year sex    young fefam_d   prop prop_low prop_upp</span></a>
<a class="sourceLine" id="cb12-9" data-line-number="9"><span class="co">#&gt;    &lt;dbl&gt; &lt;fct&gt;  &lt;chr&gt; &lt;fct&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb12-10" data-line-number="10"><span class="co">#&gt;  1  1977 Male   No    Agree    0.726    0.685    0.766</span></a>
<a class="sourceLine" id="cb12-11" data-line-number="11"><span class="co">#&gt;  2  1977 Male   No    Disagree 0.274    0.234    0.315</span></a>
<a class="sourceLine" id="cb12-12" data-line-number="12"><span class="co">#&gt;  3  1977 Male   Yes   Agree    0.551    0.469    0.633</span></a>
<a class="sourceLine" id="cb12-13" data-line-number="13"><span class="co">#&gt;  4  1977 Male   Yes   Disagree 0.449    0.367    0.531</span></a>
<a class="sourceLine" id="cb12-14" data-line-number="14"><span class="co">#&gt;  5  1977 Female No    Agree    0.674    0.639    0.709</span></a>
<a class="sourceLine" id="cb12-15" data-line-number="15"><span class="co">#&gt;  6  1977 Female No    Disagree 0.326    0.291    0.361</span></a>
<a class="sourceLine" id="cb12-16" data-line-number="16"><span class="co">#&gt;  7  1977 Female Yes   Agree    0.415    0.316    0.514</span></a>
<a class="sourceLine" id="cb12-17" data-line-number="17"><span class="co">#&gt;  8  1977 Female Yes   Disagree 0.585    0.486    0.684</span></a>
<a class="sourceLine" id="cb12-18" data-line-number="18"><span class="co">#&gt;  9  1985 Male   No    Agree    0.542    0.496    0.587</span></a>
<a class="sourceLine" id="cb12-19" data-line-number="19"><span class="co">#&gt; 10  1985 Male   No    Disagree 0.458    0.413    0.504</span></a>
<a class="sourceLine" id="cb12-20" data-line-number="20"><span class="co">#&gt; # … with 158 more rows</span></a></code></pre></div>
<div id="plot-the-results" class="section level3">
<h3 class="hasAnchor">
<a href="#plot-the-results" class="anchor"></a>Plot the Results</h3>
<p>We finish with a polished plot of the trends in <code>fefam</code> over time, for men and women in two (recoded) age groups over time.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span>())</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"></a>
<a class="sourceLine" id="cb13-3" data-line-number="3">facet_names &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"No"</span> =<span class="st"> "Age Over 25 when surveyed"</span>, </a>
<a class="sourceLine" id="cb13-4" data-line-number="4">                 <span class="st">"Yes"</span> =<span class="st"> "Age 18-25 when surveyed"</span>)</a>
<a class="sourceLine" id="cb13-5" data-line-number="5">fefam_txt &lt;-<span class="st"> "Disagreement with the statement, ‘It is much better for</span><span class="ch">\n</span><span class="st">everyone involved if the man is the achiever outside the</span><span class="ch">\n</span><span class="st">home and the woman takes care of the home and family’"</span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6"></a>
<a class="sourceLine" id="cb13-7" data-line-number="7">out_ff <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(fefam_d <span class="op">==</span><span class="st"> "Disagree"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="dt">mapping =</span> </a>
<a class="sourceLine" id="cb13-10" data-line-number="10">           <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> year, <span class="dt">y =</span> prop,</a>
<a class="sourceLine" id="cb13-11" data-line-number="11">               <span class="dt">ymin =</span> prop_low, </a>
<a class="sourceLine" id="cb13-12" data-line-number="12">               <span class="dt">ymax =</span> prop_upp,</a>
<a class="sourceLine" id="cb13-13" data-line-number="13">               <span class="dt">color =</span> sex, </a>
<a class="sourceLine" id="cb13-14" data-line-number="14">               <span class="dt">group =</span> sex, </a>
<a class="sourceLine" id="cb13-15" data-line-number="15">               <span class="dt">fill =</span> sex)) <span class="op">+</span></a>
<a class="sourceLine" id="cb13-16" data-line-number="16"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="dt">size =</span> <span class="fl">1.2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb13-17" data-line-number="17"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span>(<span class="dt">alpha =</span> <span class="fl">0.3</span>, <span class="dt">color =</span> <span class="ot">NA</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb13-18" data-line-number="18"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span>(<span class="dt">breaks =</span> <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dv">1978</span>, <span class="dv">2018</span>, <span class="dv">4</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb13-19" data-line-number="19"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span>(<span class="dt">labels =</span> scales<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/scales/man/number_format.html">percent_format</a></span>(<span class="dt">accuracy =</span> <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb13-20" data-line-number="20"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="dt">values =</span> <span class="kw">my_colors</span>(<span class="st">"bly"</span>)[<span class="dv">2</span><span class="op">:</span><span class="dv">1</span>],</a>
<a class="sourceLine" id="cb13-21" data-line-number="21">                     <span class="dt">labels =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Men"</span>, <span class="st">"Women"</span>),</a>
<a class="sourceLine" id="cb13-22" data-line-number="22">                     <span class="dt">guide =</span> <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span>(<span class="dt">title=</span><span class="ot">NULL</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb13-23" data-line-number="23"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span>(<span class="dt">values =</span> <span class="kw">my_colors</span>(<span class="st">"bly"</span>)[<span class="dv">2</span><span class="op">:</span><span class="dv">1</span>],</a>
<a class="sourceLine" id="cb13-24" data-line-number="24">                    <span class="dt">labels =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Men"</span>, <span class="st">"Women"</span>),</a>
<a class="sourceLine" id="cb13-25" data-line-number="25">                    <span class="dt">guide =</span> <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span>(<span class="dt">title=</span><span class="ot">NULL</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb13-26" data-line-number="26"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(<span class="op">~</span><span class="st"> </span>young, <span class="dt">labeller =</span> <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/as_labeller.html">as_labeller</a></span>(facet_names),</a>
<a class="sourceLine" id="cb13-27" data-line-number="27">             <span class="dt">ncol =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb13-28" data-line-number="28"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span>(<span class="dt">xlim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1977</span>, <span class="dv">2017</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb13-29" data-line-number="29"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="dt">x =</span> <span class="st">"Year"</span>,</a>
<a class="sourceLine" id="cb13-30" data-line-number="30">       <span class="dt">y =</span> <span class="st">"Percent Disagreeing"</span>,</a>
<a class="sourceLine" id="cb13-31" data-line-number="31">       <span class="dt">subtitle =</span> fefam_txt,</a>
<a class="sourceLine" id="cb13-32" data-line-number="32">       <span class="dt">caption =</span> <span class="st">"Kieran Healy http://socviz.co.</span><span class="ch">\n</span></a>
<a class="sourceLine" id="cb13-33" data-line-number="33"><span class="st">         Data source: General Social Survey"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb13-34" data-line-number="34"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="dt">legend.position =</span> <span class="st">"bottom"</span>)</a></code></pre></div>
<p><img src="overview_files/figure-html/fefamplot-1.png" width="768"></p>
</div>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<p>Lumley, Thomas (2010). <em>Complex Surveys: A Guide to Analysis Using R</em>. New York: Wiley.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#setup-packages-and-functions">Setup, Packages, and Functions</a></li>
      <li><a href="#loading-the-gssr-package-and-data">Loading the gssr package and data</a></li>
      <li><a href="#descriptive-analysis-of-the-data-an-example">Descriptive analysis of the data: an example</a></li>
      <li><a href="#calculate-the-survey-weighted-statistics">Calculate the survey-weighted statistics</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="http://kieranhealy.org">Kieran Healy</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
