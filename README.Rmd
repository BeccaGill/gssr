---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
  )

get_badge <- function (pkg, type = c("last-month", "last-week", "grand-total"), 
    color = "green") 
{
    type <- match.arg(type)
    svg <- paste0("http://cranlogs.r-pkg.org/badges/", type, 
        "/", pkg, "?color=", color)
    url <- paste0("https://cran.r-project.org/package=", pkg)
    placeholder <- "CRAN link"
    paste0("[![](", svg, ")](", url, ")")
}

library(tidyverse)
library(panelr)

```

# gssr <img src="man/figures/gssr.png" align="right" width="120" />

<!-- badges: start -->
[![Build Status](https://travis-ci.org/kjhealy/gssr.svg?branch=master)](https://travis-ci.org/kjhealy/gssr) 

<!-- badges: end -->

The General Social Survey Cumulative Data (1972-2018) and Three Wave Panel Data files packaged for easy use in R. 

<img src="man/figures/fefam_svy.png" width = "95%"/>

## Installation

You can install the beta version of gssr from [GitHub](https://github.com/kjhealy/gssr) with:

``` r
devtools::install_github("kjhealy/gssr")
```

## Loading the data

### The Cumulative Data File

The GSS cumulative data file is rather large, and so it is not loaded by default when you invoke the package. (That is, we don't use R's "lazy loading" facility.) To load the data, do the following:

```{r load}
library(gssr)
data(gss_all)
```

```{r peek}

gss_all

```

To load the tibble that contains information on the variables in the data, do this:

```{r load-doc}
data(gss_doc)

gss_doc
```

You can take a look at information on a particular variable by doing something like this:

```{r varlook}

gss_doc %>% filter(id == "race") %>% 
  select(id, description, text)

```

To look at a variable's marginals or its properties, use `unnest()`:

```{r marginals}

gss_doc %>% filter(id == "race") %>%
  select(marginals) %>% 
  unnest(cols = c(marginals))

```


```{r properties}

gss_doc %>% filter(id == "race") %>%
    select(properties) %>%
    unnest(cols = c(properties))

```

There are convenience functions to do this as well, for one or more categorical variables. One for the marginals:

```{r getfnex}
gss_get_marginals(varnames = c("race", "sex"))
```

And one for the properties:

```{r getfnex2}
gss_get_props(varnames = c("race", "sex"))
```

## Panel Data

The GSS Three Wave Panel dataset was collected in 2006, 2008, and 2010. These data are separate from the Cumulative Data File. The dataset is provided by the GSS in wide format but packaged here in long format. The conversion was carried out using the [`panelr` package](https://panelr.jacob-long.com) and its `long_panel()` function. Load the panel data as follows:

```{r panel}
data(gss_panel_long)

gss_panel_long
```

The data object is of class `panel_data`, a type of tibble created by `panelr`. The column names in long format do not have wave identifiers. Rather, `id` and a `wave` variables track the cases:

```{r panel-fefam}
gss_panel_long %>% select(fefam)
```

The documentation tibble for the panel data is called `gss_panel_doc`.

```{r paneldoc}
data(gss_panel_doc)

gss_panel_doc
```

Because it was created from the main GSS codebook, it is in wide format and the time-varying variables have wave identifiers. The identifiers are the suffixes `_1`, `_2`, and `_3`, for the first, second, and third waves. The variable names are capitalized. The categorical variables in the panel codebook can be queried in the same way as those in the cumulative codebook. We specify that we want to look at `gss_panel_doc` rather than `gss_doc`.

```{r paneldocfun}
gss_get_marginals(varnames = c("SEX_1", "SEX_2", "SEX_3"), data = gss_panel_doc)
```

## Further details

The package is documented at <http://kjhealy.github.io/gssr/>. The GSS homepage is at <http://gss.norc.org/>. While the `gssr` package incorporates the publicly-available GSS cumulative data file, the package is not associated with or endorsed by the National Opinion Research Center or the General Social Survey. 
